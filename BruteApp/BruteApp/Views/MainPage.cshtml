@inherits Umbraco.Web.Mvc.UmbracoTemplatePage<ContentModels.MainPage>
@using BruteApp.Helpers
@using ContentModels = Umbraco.Web.PublishedContentModels;
@{
    Layout = "MasterLayout.cshtml";    
}

@section styles {    
    <link href="~/css/index.css" rel="stylesheet" />
    <link href="~/css/select2.css" rel="stylesheet" />
}

@section svg {
    <svg style="display: none">
        <filter id='grayscale'>
            <feColorMatrix type='matrix'
                           values='0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0'/>
        </filter>
    </svg>
}

<article>
    @*@{
        var catalog = (Catalog)Umbraco.TypedContentSingleAtXPath(string.Format("//{0}", AttributeHelper.GetTypeAlias<Catalog>()));
        var musicians = catalog.Children.SelectMany(item => item.Children).Cast<Musician>().ToList();
        var songs = musicians.SelectMany(item => item.Children.Cast<Song>()).ToList();
        var distinctSongs = songs.GroupBy(x => x.NavigationName).Select(y => y.First());
    }*@
    <div class="content">
        <div class="container-fluid">
            <div class="row">
                <div class="filters-section">
                    <div class="col-xl-5">
                        <div class="search">
                            <select class="js-example-basic" type="text" placeholder="Введите название группы" autocomplete="off" autocorrect="off" name="list[]"></select>
                            <button>
                                <i class="br-search"></i>
                            </button>
                        </div>
                    </div>
                    @CreateCatlogMenu()
                </div>
            </div>

            <div class="row">
                <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3 col-xxl-2">
                    <a href="javascript:void(0)" class="musician">
                        <img src="img/foals.jpg"/>
                        <div class="description">
                            <p>Foals</p>
                            <span>перевод песен</span>
                        </div>
                    </a>
                </div>
                <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3 col-xxl-2">
                    <a href="javascript:void(0)" class="musician">
                        <img src="img/HIM.jpg"/>
                        <div class="description">
                            <p>HIM</p>
                            <span>перевод песен</span>
                        </div>
                    </a>
                </div>
                <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3 col-xxl-2">
                    <a href="javascript:void(0)" class="musician">
                        <img src="img/Kings-of-Leon.jpg"/>
                        <div class="description">
                            <p>Kings of leon</p>
                            <span>перевод песен</span>
                        </div>
                    </a>
                </div>
                <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3 col-xxl-2">
                    <a href="javascript:void(0)" class="musician">
                        <img src="img/TheSunshineUnderground.jpg"/>
                        <div class="description">
                            <p>The sunshine Underground</p>
                            <span>перевод песен</span>
                        </div>
                    </a>
                </div>
                <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3 col-xxl-2">
                    <a href="javascript:void(0)" class="musician">
                        <img src="img/Kings-of-Leon.jpg"/>
                        <div class="description">
                            <p>The sunshine Underground</p>
                            <span>перевод песен</span>
                        </div>
                    </a>
                </div>
                <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3 col-xxl-2">
                    <a href="javascript:void(0)" class="musician">
                        <img src="img/foals.jpg"/>
                        <div class="description">
                            <p>The sunshine Underground</p>
                            <span>перевод песен</span>
                        </div>
                    </a>
                </div>
                <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3 col-xxl-2">
                    <a href="javascript:void(0)" class="musician">
                        <img src="img/foals.jpg"/>
                        <div class="description">
                            <p>The sunshine Underground</p>
                            <span>перевод песен</span>
                        </div>
                    </a>
                </div>
                <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3 col-xxl-2">
                    <a href="javascript:void(0)" class="musician">
                        <img src="img/TheSunshineUnderground.jpg"/>
                        <div class="description">
                            <p>The sunshine Underground</p>
                            <span>перевод песен</span>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>
</article>

@section scripts {
    <script src="~/scripts/main.js"></script>
    <script>
        var a = $.ajax({
            type: "GET",
            url: '/umbraco/surface/searchSurface/search'
        });
        console.log(a);

        $(document).ready(function() {
            $('.js-example-basic').select2({
                placeholder: 'Введите название песни или имя исполнителя',
                minimumInputLength: 1,
                maximumInputLength: 20,
                width: 200,
                ajax: {
                    url: '/umbraco/surface/searchSurface/search',
                    dataType: 'json',
                    delay: 250,
                    //data: function(params) {
                    //    return {
                    //        query: "abc"
                    //    };
                    //},
                    processResults: function(data) {
                        return {
                            results: data
                        };
                    }
                }                
        });
    });


        //data: [
        //    {
        //        id: 0,
        //        text: 'a'
        //    },
        //    {
        //        id: 1,
        //        text: "b"
        //    },
        //    {
        //        id: 2,
        //        text: "c"
        //    },
        //    {
        //        id: 3,
        //        text: "d"
        //    }
        //]


        //$.ajax({
        //    type: "GET",
        //    url: "/umbraco/surface/searchSurface/search",
        //    success: function (data) {
        //        console.log("data = " + JSON.stringify(data));
        //        $('.typeahead').typeahead({
        //            minLength: 1,
        //            items: 10,
        //            source: data
        //        });
        //    }
        //});

        //$('.typeahead').typeahead({
        //    minLength: 1,
        //    items: 10,
        //    source: function(query, process) {
        //        return $.get("/umbraco/surface/searchSurface/search", { query: query }, function(response){
        //            return process(response);
        //        });
        //    }
        //});


    </script>
}

@helper CreateCatlogMenu()
{
    var catalog = (Catalog) Umbraco.TypedContentSingleAtXPath(string.Format("//{0}", AttributeHelper.GetTypeAlias<Catalog>()));

    <div class="col-xl-7 no-padding">
        <div class="filter">
            <p>Выберите исполнителя по первой букве (цифре):</p>
            <ul>
                @foreach (var item in catalog.Children.OrderBy(x => x.GetPropertyValue("NavigationName")))
                {
                    if ((string) item.GetPropertyValue("navigationName") != string.Empty)
                    {
                        <li>
                            <a href="@item.Url">@item.GetPropertyValue("navigationName")</a>
                        </li>
                    }
                }
            </ul>
        </div>
    </div>
}